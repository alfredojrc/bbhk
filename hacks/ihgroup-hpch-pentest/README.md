# GCP Infrastructure Penetration Test
## Targets: ihgroup.to & hpch.ch

**Test Date**: 2025-11-20
**Authorization**: Confirmed by owner
**Environment**: Non-production (test/dev/prod subdomains)
**Scope**: Authorized security testing of owned infrastructure

---

## üéØ EXECUTIVE SUMMARY

### Target Infrastructure

| Domain | Subdomain | IP Address | Hosting | Status |
|--------|-----------|------------|---------|--------|
| ihgroup.to | test/prod/dev | 136.110.148.157 | Google Cloud Platform ‚úÖ | Testing Phase |
| hpch.ch | test/prod/dev | 34.8.134.55 | Google Cloud Platform ‚úÖ | Testing Phase |

### IP Verification Results

**Target 1: 136.110.148.157**
```
Organization: Google LLC (GOOGL-2)
NetRange: 136.107.0.0 - 136.111.255.255
Allocation Date: 2024-08-01 (Recent)
Location: Mountain View, CA
Confirmed: Google Cloud Platform
```

**Target 2: 34.8.134.55**
```
Organization: Google LLC (GOOGL-2)
NetRange: 34.4.5.0 - 34.63.255.255
Allocation Date: 2022-05-09
Location: Mountain View, CA
Confirmed: Google Cloud Platform
```

---

## üìö DOCUMENTATION

### Core Files

1. **GCP_RECON_METHODOLOGY.md** - Complete reconnaissance methodology
   - Phase 1: IP verification and region detection
   - Phase 2: WAF/IDS/IPS detection strategies
   - Phase 3: Safe scanning practices for GCP
   - Phase 4: Initial reconnaissance commands
   - Phase 5: Kali tools inventory
   - Phase 6: Google Cloud Armor specific tests
   - Phase 7: Documentation and reporting

2. **quick-recon.sh** - Automated reconnaissance script
   - Modes: passive / active / full
   - Safety checks and authorization prompts
   - Organized output directory structure
   - Summary reports and statistics

3. **README.md** (this file) - Project overview and quick reference

---

## üöÄ QUICK START

### Prerequisites Check
```bash
# Verify required tools are installed
which wafw00f nmap subfinder httpx whatweb nuclei curl dig

# All tools confirmed present on Kali system ‚úÖ
```

### Running Reconnaissance

#### Option 1: Automated Script (Recommended)
```bash
# Passive reconnaissance only (safest)
./quick-recon.sh passive

# Active reconnaissance (requires authorization)
./quick-recon.sh active

# Complete reconnaissance
./quick-recon.sh full
```

#### Option 2: Manual Step-by-Step
```bash
# See GCP_RECON_METHODOLOGY.md Phase 4 for detailed commands
```

---

## üîç KEY FINDINGS

### WAF/IDS Detection Capabilities

**wafw00f Support**: ‚úÖ **Google Cloud App Armor** detection available!
```bash
wafw00f -l | grep -i google
# Output: Google Cloud App Armor ‚Üí Google Cloud
```

**Nmap NSE Scripts Available**:
- `/usr/share/nmap/scripts/http-waf-detect.nse` ‚úÖ
- `/usr/share/nmap/scripts/http-waf-fingerprint.nse` ‚úÖ
- `/usr/share/nmap/scripts/firewall-bypass.nse` ‚úÖ

### Google Cloud Armor Detection Indicators

**Positive Detection Signs**:
1. HTTP Headers:
   - `Server: Google Frontend`
   - `Via: 1.1 google`
   - `X-Cloud-Trace-Context` (GCP-specific)
   - Custom `X-Goog-*` headers
   - `Alt-Svc: h3=":443"` (Google QUIC)

2. Error Page Patterns:
   - GCP-styled 403/429 responses
   - Error IDs: `Error: Error403`
   - References to Cloud Armor policy

3. Behavioral Patterns:
   - JA3/JA4 fingerprinting (SSL/TLS client detection)
   - Request body inspection (up to 64KB)
   - OWASP Core Rule Set v3.3 blocking patterns
   - Rate limiting at predictable thresholds

4. SSL/TLS:
   - Google Trust Services certificates
   - HTTP/3 and QUIC protocol support

---

## üõ†Ô∏è TOOLS INVENTORY

### Available on System

| Tool | Purpose | Stealth Level | Status |
|------|---------|---------------|--------|
| **wafw00f** | WAF fingerprinting | High (passive) | ‚úÖ |
| **nmap** | Port/service scanning | Medium | ‚úÖ |
| **masscan** | Fast port scanning | Low (noisy) | ‚úÖ |
| **httpx** | HTTP probing | High | ‚úÖ |
| **subfinder** | Subdomain enum | High (passive) | ‚úÖ |
| **nuclei** | Vulnerability scanning | Medium | ‚úÖ |
| **whatweb** | Tech fingerprinting | High | ‚úÖ |
| **nikto** | Web server scanning | Low (very noisy) | ‚úÖ |
| **curl** | HTTP requests | High | ‚úÖ |
| **dig/host** | DNS queries | High (passive) | ‚úÖ |

### Not Installed
- **whatwaf** - Alternative WAF detector (can be installed if needed)

---

## ‚öôÔ∏è RECOMMENDED SCAN SETTINGS

### Nmap Timing Templates

**For Stealth & GCP Compliance**:
```bash
# INITIAL DISCOVERY (SAFEST)
nmap -T2 -Pn --top-ports 100 136.110.148.157
# -T2 = Polite timing (uses less bandwidth)
# -Pn = Skip ping (GCP often blocks ICMP)

# SERVICE ENUMERATION (MODERATE)
nmap -T3 -Pn -sV -p 80,443,8080,8443 136.110.148.157
# -T3 = Normal timing (default)
# -sV = Version detection

# DETAILED ANALYSIS (USE WITH CAUTION)
nmap -T2 -Pn -sC -sV -p 80,443 --script="not intrusive and not dos" 136.110.148.157
# -sC = Safe scripts only
# Exclude aggressive scripts
```

**AVOID**: `-T4` or `-T5` timing (will trigger rate limiting!)

### Rate Limiting Best Practices

```bash
# Conservative limits for authorized testing:
# - Max 10 requests/second per target
# - 100ms delay between requests
# - Randomize timing to avoid patterns

# Nuclei with rate limiting
nuclei -u https://test.ihgroup.to -rl 10 -c 5
# -rl 10 = 10 requests/second max
# -c 5 = 5 concurrent templates

# Masscan (very conservative)
masscan -p1-65535 136.110.148.157 --rate=100 --wait 3
# --rate=100 = 100 packets/second
```

---

## üìã GCP PENETRATION TESTING POLICY

### Authorization Requirements ‚úÖ

**What's Allowed** (per Google Cloud AUP):
- ‚úÖ Testing resources you own/control
- ‚úÖ No prior notification to Google required
- ‚úÖ Compliance with GCP Terms of Service
- ‚úÖ Vulnerability scanning and penetration testing

**What's Prohibited** ‚ùå:
- ‚ùå Testing other customers' resources
- ‚ùå DoS/DDoS attacks
- ‚ùå Social engineering against Google employees
- ‚ùå Physical security testing of Google facilities
- ‚ùå Excessive traffic that impacts Google infrastructure

**Reference**: https://support.google.com/cloud/answer/6262505

---

## üéØ RECONNAISSANCE PHASES

### Phase 1: Passive Recon (Undetectable) - 2-4 hours
```bash
‚úì DNS enumeration (A, AAAA, MX, TXT, NS, SOA)
‚úì WHOIS lookups
‚úì Subdomain discovery (passive sources)
‚úì SSL/TLS certificate analysis
‚úì Technology fingerprinting
‚úì HTTP header collection
```

### Phase 2: Active Recon (Low Impact) - 3-5 hours
```bash
‚úì WAF detection (wafw00f)
‚úì Nmap WAF fingerprinting
‚úì Top 1000 ports scan (-T2 timing)
‚úì Service version detection (80,443,8080,8443)
```

### Phase 3: Vulnerability Assessment (Moderate Impact) - Ongoing
```bash
‚úì WAF bypass testing
‚úì Nuclei vulnerability scans (rate-limited)
‚úì Manual application testing
‚úì Business logic testing
```

---

## üìÅ OUTPUT DIRECTORY STRUCTURE

```
/home/kali/bbhk/hacks/ihgroup-hpch-pentest/
‚îú‚îÄ‚îÄ README.md                      # This file
‚îú‚îÄ‚îÄ GCP_RECON_METHODOLOGY.md       # Complete methodology
‚îú‚îÄ‚îÄ quick-recon.sh                 # Automated scanner
‚îî‚îÄ‚îÄ recon/
    ‚îú‚îÄ‚îÄ dns/                       # DNS records, WHOIS, subdomains
    ‚îú‚îÄ‚îÄ waf/                       # WAF detection results
    ‚îú‚îÄ‚îÄ ports/                     # Port scan outputs
    ‚îú‚îÄ‚îÄ tech/                      # Technology fingerprints
    ‚îú‚îÄ‚îÄ ssl/                       # SSL/TLS certificates
    ‚îú‚îÄ‚îÄ scans/                     # Vulnerability scan results
    ‚îú‚îÄ‚îÄ screenshots/               # Visual evidence
    ‚îî‚îÄ‚îÄ reports/                   # Final reports
```

---

## ‚ö†Ô∏è SAFETY CHECKLIST

Before starting ANY scanning:
- [ ] ‚úÖ Confirmed written authorization from target owner
- [ ] ‚úÖ Verified correct IP addresses (136.110.148.157, 34.8.134.55)
- [ ] ‚úÖ Start with passive reconnaissance only
- [ ] ‚úÖ Use conservative timing (-T2 or slower)
- [ ] [ ] Monitor for rate limiting/blocking
- [ ] [ ] Document all activities with timestamps
- [ ] [ ] Have incident response plan ready
- [ ] [ ] Know who to contact if issues arise

**STOP scanning immediately if**:
- You receive 403/429 errors repeatedly
- You detect unusual latency or timeouts
- You receive legal/abuse notifications
- You're unsure about authorization scope

---

## üîó USEFUL REFERENCES

### Google Cloud Documentation
- Security FAQ: https://support.google.com/cloud/answer/6262505
- Cloud Armor Docs: https://cloud.google.com/armor/docs
- Cloud IDS Overview: https://cloud.google.com/intrusion-detection-system/docs/overview

### Security Standards
- OWASP CRS v3.3: https://owasp.org/www-project-modsecurity-core-rule-set/
- OWASP Testing Guide: https://owasp.org/www-project-web-security-testing-guide/

### Tools
- Nmap Timing Templates: https://nmap.org/book/performance-timing-templates.html
- wafw00f GitHub: https://github.com/EnableSecurity/wafw00f
- Nuclei Templates: https://github.com/projectdiscovery/nuclei-templates

---

## üìä EXPECTED TIMELINE

| Phase | Duration | Impact Level | Detection Risk |
|-------|----------|--------------|----------------|
| Passive Recon | 2-4 hours | None | None |
| Active Recon | 3-5 hours | Low | Low |
| Vulnerability Assessment | 1-2 days | Moderate | Medium |
| Manual Testing | Ongoing | Variable | Variable |

---

## üéì NEXT STEPS

1. **Run Passive Reconnaissance**:
   ```bash
   ./quick-recon.sh passive
   ```

2. **Review Passive Results**:
   - Check DNS records for subdomains
   - Analyze SSL/TLS certificates
   - Review technology fingerprints
   - Look for GCP-specific headers

3. **If Clear to Proceed, Run Active Recon**:
   ```bash
   ./quick-recon.sh active
   ```

4. **Analyze WAF/IDS Presence**:
   - Review wafw00f results
   - Check for Cloud Armor indicators
   - Document rate limiting behavior
   - Test safe bypass techniques

5. **Manual Testing**:
   - Follow GCP_RECON_METHODOLOGY.md Phase 6
   - Test specific features (JA4, request inspection, OWASP CRS)
   - Document all findings

6. **Report & Remediate**:
   - Create comprehensive report
   - Coordinate with target owner
   - Implement security improvements

---

## üìù NOTES

### System Configuration
- **OS**: Kali Linux
- **Location**: /home/kali/bbhk/hacks/ihgroup-hpch-pentest/
- **Tools**: All verified present and functional ‚úÖ
- **Network**: Direct internet access (no VPN/proxy configured)

### Important Reminders
- These targets are in **testing phase** (non-production)
- Always use **conservative timing** to avoid triggering alarms
- **Document everything** with timestamps
- **Monitor responses** for 403/429 errors
- **Stop immediately** if you detect blocking or legal issues

---

**Created**: 2025-11-20
**Author**: BBHK Scout Agent üó∫Ô∏è
**Version**: 1.0
**Status**: Ready for execution (pending final authorization)
